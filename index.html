<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>PG IDF</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}
header{
  background:#020617;
  padding:20px;
}
.hidden{display:none}
.card{
  background:#020617;
  padding:30px;
  max-width:420px;
  margin:80px auto;
  border-radius:10px;
}
input,select,button{
  padding:12px;
  width:90%;
  font-size:16px;
  margin-top:10px;
}
button{
  background:#1e293b;
  color:white;
  border:none;
  cursor:pointer;
}
.container{
  display:flex;
  height:calc(100vh - 90px);
}
.sidebar{
  width:260px;
  background:#020617;
  padding:10px;
}
.sidebar button{
  width:100%;
  margin-bottom:6px;
}
.content{
  flex:1;
  padding:15px;
  text-align:left;
}
.chat-box{
  height:260px;
  overflow-y:auto;
  background:#020617;
  padding:8px;
  margin-bottom:6px;
}
.chat-input{
  display:flex;
  gap:5px;
}
.chat-input input{flex:1}
.log{font-size:13px;color:#cbd5f5}
canvas{background:#020617;border:1px solid #334155}
</style>
</head>

<body>

<header>
  <h1>PG IDF</h1>
  <p>××¢×¨×›×ª ×¤×™×§×•×“ ×¤× ×™××™×ª</p>
</header>

<!-- ×©×œ×‘ 1: ×‘×—×™×¨×ª ×©× -->
<div id="stepName" class="card">
  <h2>×”×–×“×”×•×ª</h2>
  <input id="username" placeholder="×”×›× ×¡ ×©×">
  <button onclick="goToRank()">×”××©×š</button>
</div>

<!-- ×©×œ×‘ 2: ×‘×—×™×¨×ª ×“×¨×’×” -->
<div id="stepRank" class="card hidden">
  <h2 id="namePreview"></h2>
  <select id="rankSelect"></select>
  <input id="cmdPass" placeholder="×¡×™×¡××ª ××¤×§×“×™× (×× ×™×©)">
  <button onclick="login()">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
</div>

<!-- ××¢×¨×›×ª -->
<div id="system" class="container hidden">

  <div class="sidebar">
    <p id="userInfo"></p>
    <button onclick="openRoom('ops')">ğŸ—ºï¸ ××‘×¦×¢×™×</button>
    <button onclick="openRoom('mainChat')">ğŸ’¬ ×¦×³××˜</button>
    <button id="cmdBtn" onclick="openRoom('commanders')">ğŸ‘‘ ××¤×§×“×™×</button>
    <button onclick="openRoom('map')">ğŸ—ºï¸ ××¤×”</button>
    <button onclick="openRoom('logs')">ğŸ—‚ï¸ ×™×•××Ÿ</button>
  </div>

  <div class="content">

    <div id="ops" class="room">
      <h3>ğŸ—ºï¸ ×—×“×¨ ××‘×¦×¢×™×</h3>
      <div class="chat-box" id="opsBox"></div>
      <div class="chat-input">
        <input id="opsInput"><button onclick="send('ops')">×©×œ×—</button>
      </div>
    </div>

    <div id="mainChat" class="room hidden">
      <h3>ğŸ’¬ ×¦×³××˜ ×¨××©×™</h3>
      <div class="chat-box" id="mainChatBox"></div>
      <div class="chat-input">
        <input id="mainChatInput"><button onclick="send('mainChat')">×©×œ×—</button>
      </div>
    </div>

    <div id="commanders" class="room hidden">
      <h3>ğŸ‘‘ ×—×“×¨ ××¤×§×“×™×</h3>
      <div class="chat-box" id="commandersBox"></div>
      <div class="chat-input">
        <input id="commandersInput"><button onclick="send('commanders')">×©×œ×—</button>
      </div>
    </div>

    <div id="map" class="room hidden">
      <h3>ğŸ—ºï¸ ××¤×” ×—×™×”</h3>
      <canvas id="mapCanvas" width="500" height="300"></canvas>
    </div>

    <div id="logs" class="room hidden">
      <h3>ğŸ—‚ï¸ ×™×•××Ÿ ×¤×¢×•×œ×•×ª</h3>
      <div class="chat-box" id="logBox"></div>
    </div>

  </div>
</div>

<script>
/* ×“×¨×’×•×ª */
const ranks=[
"×˜×•×¨××™","×¨×‘×´×˜","×¡××œ","×¡××œ ×¨××©×•×Ÿ","×¡×’×´×","×¡×’×Ÿ","×¡×¨×Ÿ","×¨×‘ ×¡×¨×Ÿ",
"×˜×™×™×¡ ×—×™×œ-×”××•×•×™×¨","×˜×™×™×¡ ×‘×›×™×¨ ×—×™×œ-×”××•×•×™×¨","×¡×’×Ÿ ××©× ×” ×—×™×œ-×”××•×•×™×¨",
"×¡×’×Ÿ ××¤×§×“ ×—×™×œ-×”××•×•×™×¨","××¤×§×“ ×—×™×œ-×”××•×•×™×¨",
"×¡×’×Ÿ ××œ×•×£","××œ×•×£ ××©× ×”","×ª×ª ××œ×•×£","××œ×•×£","×¨×‘ ××œ×•×£"
];
const CMD_INDEX=ranks.indexOf("××¤×§×“ ×—×™×œ-×”××•×•×™×¨");
const CMD_PASSWORD="1234";

ranks.forEach(r=>rankSelect.appendChild(new Option(r,r)));

let user={};

/* ××¢×‘×¨ ××©× ×œ×“×¨×’×” */
function goToRank(){
  if(!username.value) return alert("×—×™×™×‘ ×©×");
  stepName.classList.add("hidden");
  stepRank.classList.remove("hidden");
  namePreview.innerText="×©×œ×•× " + username.value;
}

/* ×›× ×™×¡×” */
function login(){
  user.name=username.value;
  user.rank=rankSelect.value;
  user.i=ranks.indexOf(user.rank);

  if(user.i>=CMD_INDEX && cmdPass.value!==CMD_PASSWORD)
    return alert("×¡×™×¡××ª ××¤×§×“×™× ×©×’×•×™×”");

  stepRank.classList.add("hidden");
  system.classList.remove("hidden");

  userInfo.innerText=user.rank+" | "+user.name;
  if(user.i<CMD_INDEX) cmdBtn.classList.add("hidden");

  loadAll();
  initMap();
  log(`×”×ª×—×‘×¨×•×ª: ${user.rank} ${user.name}`);
}

/* ×—×“×¨×™× */
function openRoom(id){
  document.querySelectorAll(".room").forEach(r=>r.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ×©×œ×™×—×” + ×‘×•×˜ */
function send(room){
  const input=document.getElementById(room+"Input");
  if(!input.value)return;
  let msg=input.value;

  if(msg.startsWith("/")) return bot(msg,room);

  save(room,`${user.rank} ${user.name}: ${msg}`);
  log(`×”×•×“×¢×” ×‘-${room}`);
  input.value="";
  load(room);
}

/* ×‘×•×˜ */
function bot(cmd,room){
  if(cmd==="/status") save(room,"[BOT] ×›×œ ×”××¢×¨×›×•×ª ×ª×§×™× ×•×ª");
  if(cmd==="/clear"){localStorage.removeItem(room);load(room);}
  if(cmd.startsWith("/alert")) save("ops","[ALERT] "+cmd.slice(7));
  log(`×¤×§×•×“×”: ${cmd}`);
}

/* ××—×¡×•×Ÿ */
function save(room,msg){
  let d=JSON.parse(localStorage.getItem(room)||"[]");
  d.push(msg);
  localStorage.setItem(room,JSON.stringify(d));
}
function load(room){
  const box=document.getElementById(room+"Box");
  if(!box)return;
  box.innerHTML=(JSON.parse(localStorage.getItem(room)||"[]"))
    .map(m=>`<p>${m}</p>`).join("");
  box.scrollTop=box.scrollHeight;
}
function loadAll(){["ops","mainChat","commanders"].forEach(load);loadLogs();}

/* ×™×•××Ÿ */
function log(text){
  let l=JSON.parse(localStorage.getItem("logs")||"[]");
  l.push(new Date().toLocaleTimeString()+" - "+text);
  localStorage.setItem("logs",JSON.stringify(l));
  loadLogs();
}
function loadLogs(){
  logBox.innerHTML=(JSON.parse(localStorage.getItem("logs")||"[]"))
    .map(e=>`<p class="log">${e}</p>`).join("");
}

/* ××¤×” */
function initMap(){
  const c=mapCanvas,ctx=c.getContext("2d");
  setInterval(()=>{
    ctx.clearRect(0,0,c.width,c.height);
    for(let i=0;i<5;i++){
      ctx.fillStyle="#22c55e";
      ctx.beginPath();
      ctx.arc(Math.random()*500,Math.random()*300,6,0,7);
      ctx.fill();
    }
  },3000);
}
</script>

</body>
</html>
